"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const f=require("path"),M=require("fs-extra"),S=require("fs"),k=require("fast-glob"),N=require("prettier");function s(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const r in t)if(r!=="default"){const n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:()=>t[r]})}}return e.default=t,Object.freeze(e)}const x=s(f),u=s(M),E=s(S),T=s(k),R=s(N);function q(t){return!["name","meta","path","component"].includes(t)}function C(t){return`,children: [${t.map($).join(",")}]`}function $(t){var i;const e=t.children?C(t.children):"",r=t.route??{},n=t.children&&t.children.some(a=>a.path==="")?"":`name: '${r.name??t.name}',`,c=t.routeMeta?",meta: "+JSON.stringify(t.routeMeta,null,2):(i=t.route)!=null&&i.meta?",meta: "+JSON.stringify(r.meta,null,2):"",o=Object.keys(r).filter(q).map(a=>`,${a}: ${JSON.stringify(r[a])}`).join(",");return`
  {
    ${n}
    path: '${t.path}',
    component: ${t.specifier}${c}${o}${e}
  }`}function j(t,e,r){const n=e?`function ${t.specifier}() { return import(/* webpackChunkName: "${r}${t.chunkName}" */ '${t.component}') }`:`import ${t.specifier} from '${t.component}'`;return t.children?[n].concat(t.children.map(c=>j(c,e,r))).join(`
`):n}function P(t,e,r){const n=t.map(o=>j(o,e,r)).join(`
`),c=t.map($).join(",");return R.format(`${n}

export default [${c}]`,{parser:"babel",semi:!1,singleQuote:!0})}function B(t,e,r){const n=e.reduce((c,o)=>{c.children||(c.children=new Map);let i=c.children.get(o);return i||(i={},c.children.set(o,i)),i},t);n.value=r}function A(t){try{const e=require("vue-template-compiler").parseComponent;return e(t,{pad:"space"})}catch{try{const e=require("@vue/compiler-sfc").parse;return e(t,{pad:"space"}).descriptor}catch{throw new Error('[vue-route-generator] Either "vue-template-compiler" or "@vue/compiler-sfc" is required.')}}}const F="route-meta",J="route";function I(t,e,r,n){const c={};return t.map(i=>i.split("/")).forEach(i=>{B(c,z(i),i)}),y(c,e,r,n)}function y(t,e,r,n,c=0){if(t.value){const o=t.value,i={name:D(o),chunkName:V(o),specifier:G(o),path:L(o,c,r),pathSegments:O(o),component:e+o.join("/")},a=n(o.join("/")),p=A(a),d=p.customBlocks.find(h=>h.type===F),_=p.customBlocks.find(h=>h.type===J);return d&&(console.warn("<route-meta> custom block is deprecated. Use <route> block instead. Found in "+o.join("/")),i.routeMeta=w(d.content,o,"route-meta")),_&&(i.route=w(_.content,o,"route")),t.children&&(i.children=m(t.children,e,r,n,i.pathSegments.length)),[i]}return t.children?m(t.children,e,r,n,c):[]}function v(t,e){const r=t[0],n=e[0];if(!r||!n)return t.length-e.length;const c=g(r)?1:0,o=g(n)?1:0,i=c-o;return i!==0?i:v(t.slice(1),e.slice(1))}function m(t,e,r,n,c){return Array.from(t.values()).reduce((o,i)=>o.concat(y(i,e,r,n,c)),[]).sort((o,i)=>v(o.pathSegments,i.pathSegments))}function w(t,e,r){try{return JSON.parse(t)}catch(n){const c=e.join("/"),o=new Error(`Invalid json format of <${r}> content in ${c}
`+n.message);throw o.file=c,o}}function g(t){return t[0]===":"}function b(t){return t==="index"}function O(t){const e=t.length-1,r=l(t[e]);return t=t.slice(0,-1).concat(r),t.map((n,c)=>{if(n[0]==="_"){const o=e===c?"?":"";return":"+n.slice(1)+o}else return n}).filter(n=>!b(n))}function z(t){const e=t[t.length-1];return t.slice(0,-1).concat(l(e))}function D(t){const e=t[t.length-1];return t=t.slice(0,-1).concat(l(e)).filter(r=>!b(r)),t.length===0?"index":t.map(r=>r[0]==="_"?r.slice(1):r).join("-")}function V(t){const e=t[t.length-1];return t=t.slice(0,-1).concat(l(e)),t.map(r=>r[0]==="_"?r.slice(1):r).join("-")}function G(t){const e=t[t.length-1],r=t.slice(0,-1).concat(l(e)).join("_").replace(/[^a-zA-Z0-9]/g,"_");return/^\d/.test(r)?"_"+r:r}function L(t,e,r){return(r||e>0?"":"/")+O(t).slice(e).join("/")}function l(t){return t.replace(/\.[^.]+$/g,"")}function Q({pages:t,importPrefix:e="@/pages/",dynamicImport:r=!0,chunkNamePrefix:n="",nested:c=!1}){const o=["**/*.vue","!**/__*__.vue","!**/__*__/**"],i=T.sync(o,{cwd:t,onlyFiles:!0}),a=I(i,e,c,p=>E.readFileSync(x.join(t,p),"utf8"));return P(a,r,n)}async function U(){const t=f.resolve("vue_routes.txt");if(!await u.pathExists(t))throw new Error("please create vue_routes.txt file with the path");const e=await u.readFile(t,"utf8").then(r=>r.trim());if(!e)throw new Error("vue_routes.txt is empty");if(!await u.pathExists(e))throw new Error(`path ${e} not exits, please enter a relative path`);if(!(await u.stat(e)).isDirectory())throw new Error("path must be a dir");if(f.isAbsolute(e))throw new Error("please enter  relative path");return e}async function Z(){const t=await U(),e=Q({importPrefix:`${t}/`,pages:t});await u.writeFile(f.resolve("generated_routes.ts"),e,{flag:"w+"}),console.log("Routes Generated...")}exports.generate=Z;
